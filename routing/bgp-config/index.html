<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="A customer-friendly blueprint for bulding Datacenter fabrics with Nokia SR Linux"><meta name=author content="Global Webscale Team"><link href=https://jerrodgerth.github.io/dc-blueprint/routing/bgp-config/ rel=canonical><link rel=icon href=../../assets/images/favicon.png><meta name=generator content="mkdocs-1.2, mkdocs-material-7.1.7"><title>BGP Configuration - Datacenter Blueprint</title><link rel=stylesheet href=../../assets/stylesheets/main.ca7ac06f.min.css><link rel=stylesheet href=../../assets/stylesheets/palette.f1a3b89f.min.css><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback"><style>:root{--md-text-font-family:"Roboto";--md-code-font-family:"Roboto Mono"}</style></head> <body dir=ltr data-md-color-scheme=default data-md-color-primary=indigo data-md-color-accent=indigo> <script>function __prefix(e){return new URL("../..",location).pathname+"."+e}function __get(e,t=localStorage){return JSON.parse(t.getItem(__prefix(e)))}</script> <script>var palette=__get("__palette");if(null!==palette&&"object"==typeof palette.color)for(var key in palette.color)document.body.setAttribute("data-md-color-"+key,palette.color[key])</script> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#fabric-routing class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <header class=md-header data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=../.. title="Datacenter Blueprint" class="md-header__button md-logo" aria-label="Datacenter Blueprint" data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> Datacenter Blueprint </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> BGP Configuration </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media data-md-color-scheme=default data-md-color-primary=indigo data-md-color-accent=indigo aria-label="Switch to dark mode" type=radio name=__palette id=__palette_1> <label class="md-header__button md-icon" title="Switch to dark mode" for=__palette_2 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M7 10a2 2 0 0 1 2 2 2 2 0 0 1-2 2 2 2 0 0 1-2-2 2 2 0 0 1 2-2m10-3a5 5 0 0 1 5 5 5 5 0 0 1-5 5H7a5 5 0 0 1-5-5 5 5 0 0 1 5-5h10M7 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3h10a3 3 0 0 0 3-3 3 3 0 0 0-3-3H7z"/></svg> </label> <input class=md-option data-md-color-media data-md-color-scheme=slate data-md-color-primary=red data-md-color-accent=red aria-label="Switch to light mode" type=radio name=__palette id=__palette_2> <label class="md-header__button md-icon" title="Switch to light mode" for=__palette_1 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3z"/></svg> </label> </form> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query data-md-state=active required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </label> <button type=reset class="md-search__icon md-icon" aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg> </button> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/jerrodgerth/dc-blueprint/ title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 496 512"><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg> </div> <div class=md-source__repository> jerrodgerth/dc-blueprint </div> </a> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../.. title="Datacenter Blueprint" class="md-nav__button md-logo" aria-label="Datacenter Blueprint" data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg> </a> Datacenter Blueprint </label> <div class=md-nav__source> <a href=https://github.com/jerrodgerth/dc-blueprint/ title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 496 512"><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg> </div> <div class=md-source__repository> jerrodgerth/dc-blueprint </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../.. class=md-nav__link> Introduction </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_2 data-md-state=indeterminate type=checkbox id=__nav_2 checked> <label class=md-nav__link for=__nav_2> Fabric Design <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Fabric Design" data-md-level=1> <label class=md-nav__title for=__nav_2> <span class="md-nav__icon md-icon"></span> Fabric Design </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../fabric/fabric-intro/ class=md-nav__link> Introduction </a> </li> <li class=md-nav__item> <a href=../../fabric/fabric-considerations/ class=md-nav__link> Considerations </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_2_3 data-md-state=indeterminate type=checkbox id=__nav_2_3 checked> <label class=md-nav__link for=__nav_2_3> Examples <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Examples data-md-level=2> <label class=md-nav__title for=__nav_2_3> <span class="md-nav__icon md-icon"></span> Examples </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../fabric/examples/example-3stage/ class=md-nav__link> 3-stage Clos </a> </li> <li class=md-nav__item> <a href=../../fabric/examples/example-5stage/ class=md-nav__link> 5-stage Clos </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3 type=checkbox id=__nav_3 checked> <label class=md-nav__link for=__nav_3> Fabric Routing <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Fabric Routing" data-md-level=1> <label class=md-nav__title for=__nav_3> <span class="md-nav__icon md-icon"></span> Fabric Routing </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../routing-intro/ class=md-nav__link> Introduction </a> </li> <li class=md-nav__item> <a href=../protocols/ class=md-nav__link> Protocol Selection </a> </li> <li class=md-nav__item> <a href=../bgp-design/ class=md-nav__link> BGP Design </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" data-md-toggle=toc type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> BGP Configuration <span class="md-nav__icon md-icon"></span> </label> <a href=./ class="md-nav__link md-nav__link--active"> BGP Configuration </a> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#ecmp class=md-nav__link> ECMP </a> </li> <li class=md-nav__item> <a href=#ebgp-optimizations-tuning-ebgp-for-a-dc-fabric class=md-nav__link> eBGP Optimizations - Tuning eBGP for a DC Fabric </a> <nav class=md-nav aria-label="eBGP Optimizations - Tuning eBGP for a DC Fabric"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#timers-and-convergence-optimization class=md-nav__link> Timers and Convergence Optimization </a> </li> <li class=md-nav__item> <a href=#mrai-minimum-router-advertisement-interval class=md-nav__link> MRAI (Minimum Router Advertisement Interval) </a> </li> <li class=md-nav__item> <a href=#keepalive-and-hold-timers class=md-nav__link> Keepalive and hold timers </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#bfd-bidirectional-forwarding-detection class=md-nav__link> BFD (Bidirectional Forwarding Detection) </a> </li> <li class=md-nav__item> <a href=#maintenance-mode class=md-nav__link> Maintenance Mode </a> </li> <li class=md-nav__item> <a href=#network-addressing class=md-nav__link> Network Addressing </a> <nav class=md-nav aria-label="Network Addressing"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#addressing-schemes class=md-nav__link> Addressing Schemes </a> </li> <li class=md-nav__item> <a href=#advertising-ipv4-routes-using-ipv6-next-hops-rfc5549 class=md-nav__link> Advertising IPv4 Routes Using IPv6 Next Hops: RFC5549 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#route-summarization class=md-nav__link> Route Summarization </a> </li> <li class=md-nav__item> <a href=#route-policy class=md-nav__link> Route Policy </a> </li> <li class=md-nav__item> <a href=#dynamic-bgp-peering class=md-nav__link> Dynamic BGP Peering </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../summary/ class=md-nav__link> Summary </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_4 data-md-state=indeterminate type=checkbox id=__nav_4 checked> <label class=md-nav__link for=__nav_4> Fabric Management <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Fabric Management" data-md-level=1> <label class=md-nav__title for=__nav_4> <span class="md-nav__icon md-icon"></span> Fabric Management </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../mgmt/mgmt-intro/ class=md-nav__link> Introduction </a> </li> <li class=md-nav__item> <a href=../../mgmt/mgmt-ztp/ class=md-nav__link> ZTP </a> </li> <li class=md-nav__item> <a href=../../mgmt/mgmt-cli/ class=md-nav__link> CLI </a> </li> <li class=md-nav__item> <a href=../../mgmt/mgmt-gnmi/ class=md-nav__link> gNMI </a> </li> <li class=md-nav__item> <a href=../../mgmt/mgmt-logging/ class=md-nav__link> Logging </a> </li> <li class=md-nav__item> <a href=../../mgmt/mgmt-summary/ class=md-nav__link> Summary </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#ecmp class=md-nav__link> ECMP </a> </li> <li class=md-nav__item> <a href=#ebgp-optimizations-tuning-ebgp-for-a-dc-fabric class=md-nav__link> eBGP Optimizations - Tuning eBGP for a DC Fabric </a> <nav class=md-nav aria-label="eBGP Optimizations - Tuning eBGP for a DC Fabric"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#timers-and-convergence-optimization class=md-nav__link> Timers and Convergence Optimization </a> </li> <li class=md-nav__item> <a href=#mrai-minimum-router-advertisement-interval class=md-nav__link> MRAI (Minimum Router Advertisement Interval) </a> </li> <li class=md-nav__item> <a href=#keepalive-and-hold-timers class=md-nav__link> Keepalive and hold timers </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#bfd-bidirectional-forwarding-detection class=md-nav__link> BFD (Bidirectional Forwarding Detection) </a> </li> <li class=md-nav__item> <a href=#maintenance-mode class=md-nav__link> Maintenance Mode </a> </li> <li class=md-nav__item> <a href=#network-addressing class=md-nav__link> Network Addressing </a> <nav class=md-nav aria-label="Network Addressing"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#addressing-schemes class=md-nav__link> Addressing Schemes </a> </li> <li class=md-nav__item> <a href=#advertising-ipv4-routes-using-ipv6-next-hops-rfc5549 class=md-nav__link> Advertising IPv4 Routes Using IPv6 Next Hops: RFC5549 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#route-summarization class=md-nav__link> Route Summarization </a> </li> <li class=md-nav__item> <a href=#route-policy class=md-nav__link> Route Policy </a> </li> <li class=md-nav__item> <a href=#dynamic-bgp-peering class=md-nav__link> Dynamic BGP Peering </a> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <a href=https://github.com/jerrodgerth/dc-blueprint/blob/master/docs/routing/bgp-config.md title="Edit this page" class="md-content__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg> </a> <h1 id=fabric-routing>Fabric Routing<a class=headerlink href=#fabric-routing title="Permanent link">#</a></h1> <h3 id=ecmp>ECMP<a class=headerlink href=#ecmp title="Permanent link">#</a></h3> <p>Enabling multiple paths simply requires the configuration of ECMP. SR Linux devices allow for up to 128 ECMP paths. For an eBGP underlay, we configure ECMP under the default network instance. See the configuration snippet below for BGP ECMP.</p> <div class=highlight><pre><span></span><code>--{ runnning }--[  ]--
A:srl1# info network-instance default
    network-instance default {
        protocols {
            bgp {
                ipv4-unicast {
                    multipath {
                        max-paths-level-1 16
                        max-paths-level-2 16
                    }
                }   
            }
        }
    }
</code></pre></div> <p>The levels in the above configuration are described as follows:</p> <ul> <li><code>max-paths-level-1</code> – next-hop-group is bound directly to a BGP IPv4 prefix</li> <li><code>max-paths-level-2</code> – next-hop-group is bound to the IPv4 or IPv6 route used to resolve a BGP next-hop (for RFC 5599, advertising/receiving IPv4 routes over IPv6 next hops)</li> </ul> <p>In SR Linux platforms, the ECMP hash is calculated from the following criteria:</p> <ul> <li>hash-seed: value -&gt; 0-65535, configure different values on each router to avoid traffic polarization effects</li> <li>protocol: IPv4 header protocol value or the IPv6 next-header value in the last extension header</li> <li>source-ip: the source IPv4/IPv6 address</li> <li>dest-ip: the destination IPv4/IPv6 address</li> <li>src-port: the source TCP/UDP port number</li> <li>dest-port: the destination TCP/UDP port number</li> </ul> <p>We can use the table below to determine hash algorithm calculation for each packet type:</p> <table> <thead> <tr> <th>Packet Type</th> <th>Hash Calculation</th> </tr> </thead> <tbody> <tr> <td>IPv4-TCP non-fragment packet</td> <td>hash-seed, source-ip, dest-ip, protocol, TCP src-port, TCP dst-port</td> </tr> <tr> <td>IPv6-TCP non-fragment packet</td> <td>hash-seed, source-ip, dest-ip, flow-label, protocol, TCP src-port, TCP dst-port</td> </tr> <tr> <td>IPv4-UDP non-fragment packet</td> <td>hash-seed, source-ip, dest-ip, protocol, UDP src-port, UDP dst-port</td> </tr> <tr> <td>IPv6-UDP non-fragment packet</td> <td>hash-seed, source-ip, dest-ip, flow-label, protocol, UDP src-port, UDP dst-port</td> </tr> </tbody> </table> <h3 id=ebgp-optimizations-tuning-ebgp-for-a-dc-fabric>eBGP Optimizations - Tuning eBGP for a DC Fabric<a class=headerlink href=#ebgp-optimizations-tuning-ebgp-for-a-dc-fabric title="Permanent link">#</a></h3> <p>As BGP is commonly used for WAN connections, the default timers for path updates and advertisements need to be tuned for a richly connected data center environment to enable faster convergence and updates.</p> <h4 id=timers-and-convergence-optimization>Timers and Convergence Optimization<a class=headerlink href=#timers-and-convergence-optimization title="Permanent link">#</a></h4> <p>Since a single data center will likely consist of hundreds or even thousands of nodes, it is important to simply the configuration and generalize the best timer values to fit most situations. As previously mentioned, the default timers are typically sufficient for a WAN centric design often utilized by service providers. In the data center, it is important to both maintain stability and match the convergence speed typically seen in link state protocols. Modifying a few main timers will help to achieve this goal.</p> <h4 id=mrai-minimum-router-advertisement-interval>MRAI (Minimum Router Advertisement Interval)<a class=headerlink href=#mrai-minimum-router-advertisement-interval title="Permanent link">#</a></h4> <p>First, let us look at the <code>advertisement interval</code>, which determines how much time must elapse between an advertisement or withdrawal of routes to a BGP peer. The default value of 30s for eBGP peers is not acceptable in a data center environment, so the recommendation is to change this value to 1s. Rather than configuring this for each peer, it can be applied to a peer group and inherited by each peer to which it is applied.</p> <div class=highlight><pre><span></span><code>--{ running }--[  ]--
A:srl1# info network-instance default
    network-instance default {
        protocols {
            bgp {
                group cloud {
                    timers {
                        minimum-advertisement-interval 1
                    }
                }
            }
        }
    }
</code></pre></div> <h4 id=keepalive-and-hold-timers>Keepalive and hold timers<a class=headerlink href=#keepalive-and-hold-timers title="Permanent link">#</a></h4> <p>By default, the <code>keepalive-interval</code> and <code>hold-time</code> values are 30s and 90s respectively. This means that a BGP peer will send a keepalive message for a session every 30 seconds. If the adjacent peer does not see a keepalive message for 90 seconds, the session will be torn down. In the data center, these values seem like a lifetime. To optimize convergence while also maintaining stability, it is recommend to change the keepalive value to 3 seconds and the hold-down timer to 9 seconds. See the sample configuration below:</p> <div class=highlight><pre><span></span><code>--{ * candidate shared default }--[  ]--
A:srl1# info network-instance default
    network-instance default {
        protocols {
            bgp {
                group cloud {
                    timers {
                        hold-time 9
                        keepalive-interval 3
                        minimum-advertisement-interval 1
                    }
                }
            }
        }
    }
</code></pre></div> <p>The above timers come into play when a BGP peer becomes unreachable. Using an additional protocol such as BFD will allow even faster convergence.</p> <h3 id=bfd-bidirectional-forwarding-detection>BFD (Bidirectional Forwarding Detection)<a class=headerlink href=#bfd-bidirectional-forwarding-detection title="Permanent link">#</a></h3> <p>BFD is a lightweight protocol that can be enabled on a point-to-point link between routers to detect link failures. It is designed to leverage hardware forwarding to enable sub-second failure detection. Once a failure is detected, the link is immediately marked down and upper layer protocols react accordingly (withdraw route, recalculate ECMP, etc.). Because BFD is a protocol unto itself, it can be used in combination with many different routing protocols to assist with faster convergence. In the case of BGP, SR Linux supports BFD for both IPv4 and IPv6 peering.</p> <p>There are two aspects of the BFD configuration. BFD must first be configured for a given subinterface and then associated with a routing protocol. Within BGP, BFD can be configured at the global, group or neighbor level.</p> <p>In this example, BFD is configured on subinterface <code>ethernet-1/2.1</code>. Timer values are specified in microseconds. The minimum value is 10,000 microseconds (0.01s).</p> <div class=highlight><pre><span></span><code>--{ running }--[ ]--
# info bfd
    bfd {
        subinterface ethernet-1/2.1 {
            admin-state enable
            desired-minimum-transmit-interval 250000
            required-minimum-receive 250000
            detection-multiplier 3
        }
    }
</code></pre></div> <p>Next, BFD is associated with BGP <code>cloud</code> peer group.</p> <div class=highlight><pre><span></span><code>--{ running }--[ ]--
# info network-instance default protocols bgp
    network-instance default {
        protocols {
            bgp {
                group cloud {
                    failure-detection {
                        enable-bfd true
                    }
                }
            }
        }
    }
</code></pre></div> <h3 id=maintenance-mode>Maintenance Mode<a class=headerlink href=#maintenance-mode title="Permanent link">#</a></h3> <p>Maintenance mode is a feature that allows you to take a network element out of service so that maintenance actions can be performed such as upgrading the software image. This feature can be applied to other applications like BGP as well. For example, a maintenance group can consist of one or more BGP neighbors and/or peer groups belonging to one or more network instances.</p> <p>Using Maintenance Mode in a Clos data center fabric will allow network operators to take advantage of the multipath capabilities of said architecture while minimizing downtime. If we reference <strong>Figure 3-4</strong>, we can apply maintenance mode one of the spines in AS 64550. </p> <figure> <img src=../../_images/fig-03-04.png width=600> <figcaption>Figure 3-4</figcaption> </figure> <p>In SR Linux systems, constructs called maintenance groups are used to associate specific objects, such as entire network instances or VRFs, BGP peer groups and neighbors with a maintenance profile. We can create a maintenance profile to specify certain policy changes to a BGP peer group or neighbor. An example policy will prepend additional AS’s in the path to gracefully force traffic to the redundancy spine in AS 64550. When maintenance mode is enabled under the group, the policy is put into effect to cause the desired action. </p> <p>Refer to the <a href="https://infocenter.nokia.com/public/SRLINUX200R6A/topic/com.srlinux.configbasics/html/configb-maintenance_mode.html?cp=3_15">Maintenance Mode</a> section of the Nokia SR Linux Configuration Basics guide for more information about configuring maintenance mode.</p> <h3 id=network-addressing>Network Addressing<a class=headerlink href=#network-addressing title="Permanent link">#</a></h3> <p>When designing the network fabric addressing scheme, the most common practice is use private addressing as described in RFC1918 for IPv4 networks and add an additional layer of load balancers and/or border routers to provide the NAT function for communication to external networks. Public IPv4 address space is typically reserved for WAN and Internet connections since that address space is becoming more and more exhausted.</p> <p>IPv6 alleviates the address exhaustion due to the sheer amount of addresses available. It is recommended to manually allocate appropriate address blocks per RFC4193 using a RFC4086 compliant random number generator to improve security. RFC4193 addresses are intended for local communications and are not expected to routable within the public domain. RFC4086 helps to ensure the allocated addresses are resistant to scanning attacks. Avoid manual addressing formats that either mirror IPv4 based addresses or incorporates words.</p> <p>This flexibility with IPv6 addressing, comes at the cost of requiring some type of interopability with IPv4 networks. IPv4 addressing is still the default in today’s networks and some applications may only support IPv4, so a transition is inevitable to reap many of the benefits of IPv6.</p> <h4 id=addressing-schemes>Addressing Schemes<a class=headerlink href=#addressing-schemes title="Permanent link">#</a></h4> <p>If we consider the network pictured in <strong>Figure 3-3</strong> and use IPv4 addressing for the fabric links the following addressing scheme could be used. The spine nodes and directly connected leaf nodes associated with AS 64550 are "POD1" and the respective nodes associated with AS 64560 are "POD2". Assuming a contiguous address block is associated with each POD and assuming IPv4 addresses: POD1 links and loopbacks will be part of subnet block 192.168.10.0/28, and POD2 links and loopbacks will part of 192.168.10.16/28. Each block contains enough addresses to carve out /31 subnets and /32 loopbacks required for the 4 node POD. If possible, end hosts connected to the leaf nodes should be assigned addresses out of a subnet that is local to a given leaf. In general, it is best to avoid subnets that span multiple racks. If there is a need for stretching subnets across racks then consider using an overlay virtual network such as EVPN/VXLAN. (Network Virtualization and Overlay networks will be covered in a future section of this data center blueprint.)</p> <h4 id=advertising-ipv4-routes-using-ipv6-next-hops-rfc5549>Advertising IPv4 Routes Using IPv6 Next Hops: RFC5549<a class=headerlink href=#advertising-ipv4-routes-using-ipv6-next-hops-rfc5549 title="Permanent link">#</a></h4> <p>Some data centers are migrating away from a purely IPv4 or dual stack environment to a fully IPv6 fabric. For small to medium size businesses, IPv4 is sufficient to support the number of devices in the network; however, larger enterprises and webscale companies may find themselves running out of IPv4 private address space, hence the need the for IPv6 implementations. In any case, the transition to IPv6 does not occur overnight, so a migration plan is required. </p> <p>Let’s consider two use cases:</p> <ol> <li>The network operator has deployed a fully IPv6 data center fabric but must still interop with IPv4 only networks during the transition period.</li> <li>The data center fabric is fully IPv4 but must interop with an IPv6 network.</li> </ol> <p>In either case, RFC5549 can solve the need for transition by providing a standard to advertise IPv4 routes using IPv6 next hops. Each interface between BGP peers only needs one or more IPv6 interfaces defined. </p> <figure> <img src=../../_images/fig-03-05.png width=600> <figcaption>Figure 3-5</figcaption> </figure> <p>In order to route and forward IPv4 packets over an IPv6 network, the data center node most support the following:</p> <ol> <li>The ability to advertise a BGP route for an IPv4 NLRI (Network Layer Reachability Information) with an IPv6 BGP next-hop address.</li> <li>The ability to receive a BGP route for an IPv4 NLRI with an IPv6 BGP next-hop address</li> </ol> <p>To enable this behavior, the BGP process must be configured to both advertise and receive IPv4 packets on the IPv6 interfaces, otherwise the packets will be discarded. See the configuration snippet below:</p> <div class=highlight><pre><span></span><code>--{ running }--[  ]--
A:srl1# info network-instance default
    network-instance default {
        protocols {
            bgp {
                group cloud {
                    ipv4-unicast {
                        advertise-ipv6-next-hops true
                        receive-ipv6-next-hops true
                    }
                }
            }
        }
    }
</code></pre></div> <h3 id=route-summarization>Route Summarization<a class=headerlink href=#route-summarization title="Permanent link">#</a></h3> <p>Route summarization is one of the techniques that allow routing to scale to support very large networks. For Clos-based networks, however, it is important that route summarization is used carefully. Generally, Clos networks will only summarize routes at the ToR/leaf, especially when a subnet is contrained to a single rack.</p> <p>When deploying many hundreds or thousands of fabric switches, it may be beneficial to summarize at the super spine layer between the "PODs". Recall <strong>Figure 3-3</strong> and the addressing scheme mentioned above:</p> <blockquote> <p>The spine nodes and directly connected leaf nodes associated with AS 64550 are "POD1" and the respective nodes associated with AS 64560 are "POD2". Assuming a contiguous address block is associated with each POD and assuming IPv4 addresses: POD1 links and loopbacks will be part of subnet block 192.168.10.0/28, and POD2 links and loopbacks will part of 192.168.10.16/28. Each block contains enough addresses to carve out /31 subnets and /32 loopbacks required for the 4 node POD.</p> </blockquote> <p>The super spines that interconnect POD1 and POD2 can summarize the routes for each POD such that any node in POD1 that needs to reach any node in POD2 will only require any one of the superspine nodes to advertise subnet 192.168.10.16/28. This summarization design will ensure that route tables stay relatively small for underlay routes, and that the spines remain as simple as possible.</p> <p>Routing and route summarization in the case of network virtualization (EVPN/VXLAN overlays) will be considered in a future revision of this document.</p> <h3 id=route-policy>Route Policy<a class=headerlink href=#route-policy title="Permanent link">#</a></h3> <p>The route policy for the fabric should kept as simple as possible to allow the policy configuration to remain repeatable throughout the data center fabric. We can implement simple export policies that export all BGP and local routes, and import policies that accept all BGP routes from adjacent BGP peers.</p> <p>Sample export policy:</p> <div class=highlight><pre><span></span><code>--{ running }--[  ]--
A:srl1# info routing-policy
    routing-policy {
        policy export {
            default-action {
                reject {
                }
            }
            statement 10 {
                match {
                    protocol bgp
                }
                action {
                    accept {
                    }
                }
            }
            statement 20 {
                match {
                    protocol local
                }
                action {
                    accept {
                    }
                }
            }
        }
    }
</code></pre></div> <p>Sample Import policy: </p> <div class=highlight><pre><span></span><code>--{ running }--[  ]--
A:srl1# info routing-policy
    routing-policy {
        policy import {
            default-action {
                reject {
                }
            }
            statement 10 {
                match {
                    protocol bgp
                }
                action {
                    accept {
                    }
                }
            }
        }
    }
</code></pre></div> <p>The policies are easily repeatable and can be applied to all data center fabric nodes in the same way, as they do not contain specific IP addresses or other node specific items.</p> <p>The super spine layer will have slightly more complicated policies to allow for route summarization. Unique policies may also be required to tie into the aggregation nodes, those policies is beyond the scope of this document. The fortunate part here is that a specific super spine policy can repeated across all super spine nodes, so there is no need to create unique policy for each device.</p> <h3 id=dynamic-bgp-peering>Dynamic BGP Peering<a class=headerlink href=#dynamic-bgp-peering title="Permanent link">#</a></h3> <p>Dynamic BGP peering is a feature that allows a network operator to simplify BGP configuration for a large number of peers based on specific match criteria. In SRL devices, Dynamic BGP peering is supported for both IPv4 and IPv6 peers. Match criteria can include either IP address blocks, ASN ranges, or both. This feature allows a repeatable configuration across devices, and most useful for automatically connecting downstream devices for spine and super spine devices in a 5-stage Clos architecture.</p> <p>See the configuration snippet below for example of matching on IP and ASN criteria:</p> <div class=highlight><pre><span></span><code>--{ running }--[  ]--
A:srl1# info network-instance default
    network-instance default {
        protocols {
            bgp {
                dynamic-neighbors {
                    accept {
                        match 192.168.10.0/24 {
                            peer-group spine
                            allowed-peer-as [
                                64550
                            ]
                        }
                    }
                }
            }
        }
    }
</code></pre></div> <p>The above configuration could be applied to the super spine for example to automatically peer with all spine switches in specific pod.</p> </article> </div> </div> <a href=# class="md-top md-icon" title="Back to top" data-md-component=top data-md-state=hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"/></svg> </a> </main> <footer class=md-footer> <nav class="md-footer__inner md-grid" aria-label=Footer> <a href=../bgp-design/ class="md-footer__link md-footer__link--prev" aria-label="Previous: BGP Design" rel=prev> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </div> <div class=md-footer__title> <div class=md-ellipsis> <span class=md-footer__direction> Previous </span> BGP Design </div> </div> </a> <a href=../summary/ class="md-footer__link md-footer__link--next" aria-label="Next: Summary" rel=next> <div class=md-footer__title> <div class=md-ellipsis> <span class=md-footer__direction> Next </span> Summary </div> </div> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg> </div> </a> </nav> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-footer-copyright> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> <div class=md-footer-social> <a href=https://github.com/jerrodgerth target=_blank rel=noopener title=github.com class=md-footer-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 496 512"><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg> </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"base": "../..", "features": ["navigation.expand", "navigation.top", "navigation.instant"], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "search": "../../assets/javascripts/workers/search.b0710199.min.js", "version": null}</script> <script src=../../assets/javascripts/bundle.76f349be.min.js></script> </body> </html>